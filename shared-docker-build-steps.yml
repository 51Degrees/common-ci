# Steps to build a Docker container.

parameters:
- name: imageRepository # Name of the repository.
- name: dockerfilePath # Path to the Dockerfile.
- name: dockerRegistryServiceConnection # A Docker registry service connection.
- name: tag # A list of tags in separate lines. e.g. beta1.1, latest

steps:
# Login to the Docker registry
- task: Docker@2
  displayName: Docker Login
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    command: 'login'

# Build the docker container
- task: Docker@2
  displayName: Docker Build
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    repository: '${{ parameters.imageRepository }}'
    command: 'build'
    Dockerfile: '${{ parameters.dockerfilePath }}'
    tags: |
      ${{ parameters.tag }}
      latest

# Logout of the Docker registry
- task: Docker@2
  displayName: Docker Logout
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    command: 'logout'