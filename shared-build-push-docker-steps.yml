# Steps to build and push a Docker container to a Docker repository.

parameters:
- name: imageRepository # Name of the repository.
- name: dockerfilePath # Path to the Dockerfile.
- name: dockerRegistryServiceConnection # A Docker registry service connection.
- name: tag # A list of tags in separate lines. e.g. beta1.1, latest

steps:
# Login to the Docker registry
- task: Docker@2
  displayName: Docker Login
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    command: 'login'

# Build and push the container to the register
- task: Docker@2
  displayName: Build and push an image to container registry
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    repository: '${{ parameters.imageRepository }}'
    command: 'buildAndPush'
    Dockerfile: '${{ parameters.dockerfilePath }}'
    tags: |
      ${{ parameters.tag }}
      latest
      
# Logout of the Docker registry
- task: Docker@2
  displayName: Docker Logout
  inputs:
    containerRegistry: '${{ parameters.dockerRegistryServiceConnection }}'
    command: 'logout'